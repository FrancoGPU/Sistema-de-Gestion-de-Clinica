<!-- Botón flotante de WhatsApp -->
<a href="https://wa.me/51123456789" class="whatsapp-float" target="_blank">
  <i class="fab fa-whatsapp"></i>
</a>

<!-- CONTENIDO PRINCIPAL -->
<main class="py-5">
  <div class="container">
    <div class="text-center mb-5">
      <h1 class="section-title">Campañas de Salud</h1>
      <p class="section-subtitle">
        Iniciativas de prevención y promoción de la salud comunitaria
      </p>
    </div>

    <!-- Cargando o Error -->
    <div *ngIf="loading" class="text-center py-5">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Cargando campañas...</span>
      </div>
      <p class="mt-3">Cargando campañas...</p>
    </div>

    <div *ngIf="error && !loading" class="alert alert-danger" role="alert">
      {{ error }}
    </div>

    <!-- Campañas desde el backend -->
    <div class="row g-4" *ngIf="!loading && !error">
      <div class="col-lg-6" *ngFor="let campania of campanias">
        <div class="card h-100 shadow-sm border-0">
          <img 
            [src]="campania.imagenUrl || 'assets/images/default-campaign.jpg'" 
            class="card-img-top" 
            alt="{{ campania.nombreCampania }}"
            style="height: 200px; object-fit: cover;"
            onerror="this.src='assets/images/default-campaign.jpg'"
          >
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-start mb-2">
              <h4 class="card-title h5">{{ campania.nombreCampania }}</h4>
              <span
                class="badge"
                [ngClass]="{
                  'bg-success': campania.estado === 'EN_CURSO',
                  'bg-warning text-dark': campania.estado === 'PLANIFICADA',
                  'bg-secondary': campania.estado === 'FINALIZADA'
                }"
              >
                {{ campania.estado }}
              </span>
            </div>
            <p class="card-text text-muted">{{ campania.descripcion }}</p>
            
            <ul class="list-unstyled mt-3">
              <li class="mb-2">
                <i class="fas fa-calendar me-2 text-primary"></i>
                {{ campania.fechaInicio | date : "dd/MM/yyyy" }} - {{ campania.fechaFinalizacion | date : "dd/MM/yyyy" }}
              </li>
              <li class="mb-2">
                <i class="fas fa-map-marker-alt me-2 text-primary"></i>
                {{ campania.lugarRealizacion }}
              </li>
              <!-- Doctores -->
              <li class="mb-2" *ngIf="campania.medicos && campania.medicos.length > 0">
                <i class="fas fa-user-md me-2 text-primary"></i>
                <strong>Doctores:</strong>
                <span *ngFor="let medico of campania.medicos; let last = last">
                  {{ medico.nombre }} {{ medico.apellido }}<span *ngIf="!last">, </span>
                </span>
              </li>
            </ul>
          </div>
          <div class="card-footer bg-white border-top-0 pb-3">
            <div class="d-grid gap-2">
              <button 
                class="btn btn-primary" 
                (click)="inscribirse(campania.idCampania)"
                [disabled]="campania.estado === 'FINALIZADA'"
                *ngIf="isLoggedIn && isPaciente"
              >
                Inscribirse
              </button>
              <button 
                class="btn btn-outline-primary" 
                routerLink="/login"
                *ngIf="!isLoggedIn"
              >
                Iniciar Sesión para Inscribirse
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Sección de registro -->
    <div class="text-center mt-5">
      <div class="card bg-primary text-white">
        <div class="card-body p-5">
          <h3>¿Quieres recibir información sobre nuestras campañas?</h3>
          <p class="mb-4">
            Suscríbete a nuestro boletín y mantente informado sobre todas
            nuestras iniciativas de salud.
          </p>
          <div class="row justify-content-center">
            <div class="col-md-6">
              <div class="input-group">
                <input
                  type="email"
                  class="form-control"
                  placeholder="Tu correo electrónico"
                  [(ngModel)]="suscripcionEmail"
                />
                <button
                  class="btn btn-light"
                  type="button"
                  (click)="suscribirse()"
                >
                  Suscribirse
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>
